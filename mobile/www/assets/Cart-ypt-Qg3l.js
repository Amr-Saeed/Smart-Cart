import{G as b,j as e,r as m,F as v,L as g,C as N,Q as w,P as y,a as P,I as L,b as V,u as H,c as I,d as k,e as M,f as $,g as D,h as F}from"./index-_dVvynX1.js";function T(t){return b({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M1 4H23V6H1V4ZM1 18H23V20H1V18ZM19.6217 14.9136L19.448 14.0436L17.4994 14.0435L17.1899 14.907L15.6275 14.9105C16.6316 12.5036 17.3767 10.7206 17.8628 9.56169C17.9898 9.25902 18.2156 9.10462 18.5482 9.10699C18.802 9.10888 19.2168 9.10912 19.7927 9.10771L21 14.9108L19.6217 14.9136ZM17.9376 12.8518H19.1936L18.7248 10.6715L17.9376 12.8518ZM7.87203 9.10561L9.44245 9.10764L7.01511 14.9136L5.42535 14.9129C4.88785 12.8424 4.49315 11.3073 4.24125 10.3076C4.16402 10.001 4.01042 9.787 3.71519 9.68577C3.45195 9.59551 3.01355 9.45594 2.4 9.26707V9.10771C3.54718 9.10757 4.38339 9.10757 4.90863 9.10771C5.34299 9.10784 5.59619 9.31703 5.67765 9.74655C5.75942 10.1779 5.96599 11.2743 6.29735 13.0359L7.87203 9.10561ZM11.5994 9.10765L10.3588 14.913L8.86434 14.9108C8.89383 14.7698 9.30682 12.8347 10.1033 9.10561L11.5994 9.10765ZM14.6307 9C15.0773 9 15.6405 9.13846 15.9652 9.26707L15.703 10.4706C15.41 10.3532 14.9284 10.1944 14.5228 10.2006C13.933 10.2097 13.569 10.4566 13.569 10.6936C13.569 11.0783 14.2015 11.272 14.8528 11.6929C15.5956 12.1729 15.6937 12.603 15.6845 13.0713C15.6739 14.0422 14.8528 15 13.12 15C12.3286 14.9882 12.0444 14.9219 11.3995 14.6936L11.6718 13.4376C12.3282 13.712 12.6066 13.7991 13.1675 13.7991C13.6816 13.7991 14.1229 13.5918 14.1267 13.2308C14.1294 12.974 13.972 12.847 13.395 12.5293C12.8181 12.2117 12.0095 11.7726 12.0199 10.8889C12.0332 9.75821 13.1066 9 14.6307 9Z"},child:[]}]})(t)}function S(t){return b({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M7 4V2H17V4H22V6H20V21C20 21.5523 19.5523 22 19 22H5C4.44772 22 4 21.5523 4 21V6H2V4H7ZM6 6V20H18V6H6ZM9 9H11V17H9V9ZM13 9H15V17H13V9Z"},child:[]}]})(t)}function Z({cartProducts:t,setQuantityChangeTrigger:s,handleDelete:o}){return e.jsxs("div",{className:"cartProduct flex flex-col w-full",children:[e.jsx("ul",{children:t.map(a=>e.jsx(B,{product:a,setQuantityChangeTrigger:s,handleDelete:o},a.id||a.product_id))}),e.jsx("a",{href:"/",children:e.jsx("span",{className:"!mt-[10px] inline-block text-[blueviolet] font-semibold  underline ",children:"Continue Shopping"})})]})}function A({cartProducts:t,children:s}){return e.jsxs("section",{className:"cart-products flex flex-col gap-4 p-4 w-full lg:w-2/3 !mt-[40px]",children:[e.jsxs("div",{className:"title",children:[e.jsx("h1",{className:"text-[3rem] text-[blueviolet] font-bold",children:"Your Cart"}),e.jsxs("p",{className:"text-[1.2rem] !pl-[8px] text-[#000000bf]",children:["You have ",t.length," items in your cart"]})]}),s]})}function B({product:t,handleDelete:s}){const[o,a]=m.useState(!1),{id:x,name:l,price:i,imageUrl:u,stockAvailability:h,unit:r,offers:c}=t;async function f(){a(!0),await s(t.product_id||x),a(!1)}return e.jsx("li",{children:e.jsxs("div",{className:"cartData border-b border-b-[var(--main-color)] relative flex-col md:flex-row flex md:gap-[30px]",children:[e.jsx("div",{children:e.jsxs("figure",{className:"relative w-[200px]",children:[e.jsx(v,{id:t.product_id||t.id,prod:!0})," ",e.jsx("img",{loading:"lazy",src:u,alt:l,className:"!mb-[20px] !mt-[20px] !rounded-[10px]"})]})}),e.jsxs("div",{className:"data md:!mt-[20px] flex flex-col w-full justify-between",children:[e.jsxs(g,{to:`/product/${x}`,children:[e.jsx("span",{className:"cartProdName inline-block text-[1.1rem] text-[var(--main-color-2)] font-bold transition-all duration-300",children:`${l} - Per ${r}`})," "]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{commingfromcartProd:!0,children:e.jsx(w,{id:t.product_id||t.id,stockAvailability:!0})}),e.jsx(y,{showContent:!0,commingFromCartProd:!0,noWidthforCartProd:!0,price:i,offers:c})]})]}),e.jsx("button",{className:"absolute text-[2rem] lg:text-[1.3rem] top-0 right-0 !mt-[20px]",onClick:f,disabled:o,"aria-label":"delete-product",children:o?e.jsx(P,{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 animate-spin text-[blueviolet]"}):e.jsx(S,{color:"#ff3333"})})]})},x)}function q(t){return b({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M438.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L338.8 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l306.7 0L233.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160z"},child:[]}]})(t)}function E({cartProducts:t,user:s,APIToialPrice:o}){const[a,x]=m.useState(!1),l=m.useMemo(()=>t.map(r=>{const c=Number(localStorage.getItem(`quantity-${r.id}`))||1;return(r.price-r.price*r.offers/100)*c}),[t]),i=m.useMemo(()=>l.reduce((r,c)=>r+c,0),[l]),u=s?o:i;function h(){x(r=>!r)}return e.jsx("section",{className:"w-full lg:w-1/3 !mt-[-65px] lg:!mt-[50px]",children:e.jsxs("div",{className:"PaymentSummary bg-[#aa8cee9e] !p-[20px] rounded-lg shadow-md flex flex-col gap-4 h-[500px]",children:[e.jsx("h2",{className:"text-[blueviolet] font-bold text-[1.4rem]",children:"Payment Summary"}),e.jsxs("div",{className:"subTotal flex justify-between text-[#000000b3] !mt-[15px]",children:[e.jsx("p",{children:"SubTotal"}),e.jsx("span",{children:`${u.toFixed(2)}EGP`})]}),e.jsxs("div",{className:"promoCode flex justify-between  !mt-[15px] items-center",children:[e.jsx("p",{className:"text-[blueviolet] font-bold text-[1.3rem]",children:"Promo Code"}),e.jsx("button",{className:"text-[blueviolet] font-bold text-[2rem]",onClick:h,children:e.jsx("span",{className:`inline-block transition-transform duration-500 ${a?"rotate-180":""}`,children:e.jsx(L,{color:"blueviolet"})})})]}),e.jsx("div",{className:`transition-all duration-500  transform  ${a?"opacity-100 h-auto translate-y-0":"opacity-0 h-0 translate-y-2 pointer-events-none"}`,children:e.jsx("form",{id:"searchForm",className:"searchBar  flex ",children:e.jsxs("div",{className:"w-full relative",children:[e.jsx("label",{className:"font-semibold text-[0.9rem] text-[#0000008c]",children:"Add Code"}),e.jsx("input",{type:"text",className:"searchInput   bg-white outline-none   rounded-lg relative h-12 w-full"}),e.jsx("button",{"aria-label":"search",type:"submit",className:"searchButton absolute !right-[-2px] top-[24px] rounded-[10px] h-12   w-[4rem] md:w-12 flex justify-center items-center",onClick:r=>r.preventDefault(),children:e.jsx(q,{color:"white",size:20})})]})})}),e.jsxs("div",{className:"Total flex justify-between  !mt-[15px] items-center",children:[e.jsx("p",{className:"text-[blueviolet] font-bold text-[2rem]",children:"Total"}),e.jsx("span",{className:"text-[1.5rem] text-black font-bold",children:`${u.toFixed(2)}EGP`})]}),e.jsx("button",{className:"w-full !mt-[15px] bg-[blueviolet] text-white font-bold text-[1.4rem] h-12 rounded-[20px] hover:bg-[#aa8cee] transition duration-300",children:"Checkout"}),e.jsx("div",{className:"place-items-center !mt-[15px]",children:e.jsx(T,{size:50})})]})})}function Q(){return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"cart-empty containerr !mt-[25px]",children:[e.jsx("h1",{className:"text-[3rem] text-[blueviolet] font-bold",children:"Your Cart"}),e.jsxs("div",{className:"flex flex-col items-center  gap-4",children:[e.jsx("picture",{children:e.jsx("img",{src:"/empty-cart.svg",alt:"cart empty",className:"w-[500px]"})}),e.jsx("h2",{className:"text-[1.5rem] text-[blueviolet] font-bold",children:"Your cart is empty"}),e.jsx("button",{className:"w-[250px] !mt-[15px] bg-[blueviolet] text-white font-bold text-[1.4rem] h-12 rounded-[20px] hover:bg-[#aa8cee] transition duration-300",children:e.jsx(g,{to:"/",children:"Browse Products"})})]})]}),e.jsx(V,{})]})}function z(){const{products:t}=H(),[s,o]=m.useState([]),{setTotalQuantity:a,totalQuantity:x}=I(),{user:l}=k(),{cart:i,fetchCart:u}=M(),{getToken:h}=$();console.log("Total Quantity in Cart:",i),l?console.log("User ID:",l.id):console.log("No user logged in");const r=i.cart||[];m.useEffect(()=>{if(l)o(r);else{const d=t.filter(n=>Number(localStorage.getItem(`quantity-${n.id}`))>0);o(d)}},[t,i,l]),console.log("Cart Products:",i),console.log("cartProducts Products:",s);const c=i.total_price||0;console.log("API Total Price:",c);async function f(d){if(console.log("Deleting item with ID:",d),!l)localStorage.removeItem(`quantity-${d}`),console.log("Item removed from cart:",d),o(n=>n.filter(p=>p.id!==d)),a(n=>n-1);else try{const n=await h(),p=await F.delete(`https://nutrigeen.com/api/cart/${l.id}/${d}`,{headers:{Authorization:`Bearer ${n}`}});console.log("Deleted from server:",p.data),o(j=>j.filter(C=>C.product_id!==d)),a(j=>j-1),await u({userId:l.id})}catch(n){console.error("Failed to delete from backend:",n)}}return console.log(s),e.jsxs(e.Fragment,{children:[e.jsx(D,{}),s.length>0?e.jsxs("div",{className:"containerr flex flex-col lg:flex-row gap-[40px] w-full h-full",children:[e.jsx(A,{cartProducts:s,children:e.jsx(Z,{cartProducts:s,handleDelete:f},s.id)}),e.jsx(E,{cartProducts:s,APIToialPrice:c,user:l})]}):e.jsx(Q,{})]})}export{z as default};
